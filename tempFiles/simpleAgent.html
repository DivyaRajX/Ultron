<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Learning Agent - Get Recommendations</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .card {
            background-color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .recommendation-list > div:nth-child(even) {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex items-start justify-center">

    <div class="w-full max-w-4xl space-y-8">
        <!-- Header -->
        <header class="text-center">
            <h1 class="text-4xl font-extrabold text-blue-800">AI Personalized Learning Agent</h1>
            <p class="mt-2 text-lg text-gray-600">Input your current profile data to get personalized content recommendations.</p>
        </header>

        <!-- Input Form Card -->
        <div class="card p-6 rounded-xl border border-gray-200">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Input Profile Data (Simulated)</h2>
            <form id="recommendationForm" class="space-y-4">
                
                <!-- Username Input (For Analysis Message) -->
                <label for="username" class="block text-sm font-medium text-gray-700">
                    Your Name or Username
                </label>
                <input 
                    type="text" 
                    id="username" 
                    name="username" 
                    placeholder="e.g., Leet_user_2025" 
                    required 
                    class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150"
                >

                <!-- Weakest Topic Input (New Dynamic Input) -->
                <div>
                    <label for="weakest_topic" class="block text-sm font-medium text-gray-700">
                        Select Your Weakest Topic
                    </label>
                    <select id="weakest_topic" name="weakest_topic" required class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                        <option value="">-- Select Topic --</option>
                        <option value="Arrays & Hashing">Arrays & Hashing</option>
                        <option value="Strings">Strings</option>
                        <option value="Sorting & Two Pointers">Sorting & Two Pointers</option>
                        <option value="Heaps">Heaps</option>
                        <option value="Dynamic Programming">Dynamic Programming</option>
                        <option value="Backtracking">Backtracking</option>
                    </select>
                </div>

                <!-- Current Solved Difficulty Input (New Dynamic Input) -->
                <div>
                    <label for="last_solved_difficulty" class="block text-sm font-medium text-gray-700">
                        Select Highest Difficulty You Consistently Solve
                    </label>
                    <select id="last_solved_difficulty" name="last_solved_difficulty" required class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                        <option value="">-- Select Difficulty --</option>
                        <option value="Easy">Easy</option>
                        <option value="Medium">Medium</option>
                        <option value="Hard">Hard</option>
                    </select>
                </div>

                <button 
                    type="submit" 
                    class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-md text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150"
                >
                    Get Personalized Recommendations
                </button>
            </form>
        </div>

        <!-- Recommendation Results Area -->
        <div id="results-container" class="space-y-6 hidden">
            <!-- Analysis Card -->
            <div id="analysis-card" class="card p-6 rounded-xl border border-blue-300 bg-blue-50">
                <h3 class="text-xl font-bold text-blue-700 mb-2">My Personalized Analysis</h3>
                <p id="analysis-text" class="text-gray-700"></p>
            </div>
            
            <!-- Problems Card -->
            <div class="card p-6 rounded-xl border border-gray-200">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Recommended Coding Problems ðŸ’»</h3>
                <div id="problems-list" class="recommendation-list border border-gray-300 rounded-lg divide-y divide-gray-200">
                    <!-- Problems will be injected here -->
                </div>
            </div>

            <!-- Articles Card -->
            <div class="card p-6 rounded-xl border border-gray-200">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Suggested Articles & Readings ðŸ“š</h3>
                <div id="articles-list" class="recommendation-list border border-gray-300 rounded-lg divide-y divide-gray-200">
                    <!-- Articles will be injected here -->
                </div>
            </div>
        </div>
        
        <!-- Loading Spinner (Hidden by default) -->
        <div id="loading-spinner" class="hidden text-center p-8">
            <div class="animate-spin inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"></div>
            <p class="mt-2 text-gray-600">Analyzing profile and generating recommendations...</p>
        </div>

        <!-- Message Box for Errors/No results -->
        <div id="message-box" class="hidden p-4 rounded-lg bg-yellow-100 text-yellow-800 border border-yellow-300">
            <p id="message-text"></p>
        </div>
    </div>

    <script>
        // --- Data Simulation (Used for content, not user profile) ---
        const DUMMY_CODING_PROBLEMS = [
            {"id": 101, "title": "Two Sum", "difficulty": "Easy", "topic": "Arrays & Hashing"},
            {"id": 102, "title": "Valid Anagram", "difficulty": "Easy", "topic": "Strings"},
            {"id": 201, "title": "Merge Sorted Array", "difficulty": "Medium", "topic": "Sorting & Two Pointers"},
            {"id": 202, "title": "K Closest Points to Origin", "difficulty": "Medium", "topic": "Heaps"},
            {"id": 301, "title": "Longest Increasing Subsequence", "difficulty": "Hard", "topic": "Dynamic Programming"},
            {"id": 302, "title": "N-Queens", "difficulty": "Hard", "topic": "Backtracking"},
            {"id": 103, "title": "Find Pivot Index", "difficulty": "Easy", "topic": "Arrays & Hashing"},
            {"id": 203, "title": "Top K Frequent Elements", "difficulty": "Medium", "topic": "Heaps"},
            {"id": 303, "title": "Maximum Subarray", "difficulty": "Hard", "topic": "Dynamic Programming"},
        ];

        const DUMMY_ARTICLES = [
            {"id": 501, "title": "Mastering Dynamic Programming: A Beginner's Guide", "topic": "Dynamic Programming", "url": "#dp-guide"},
            {"id": 502, "title": "Arrays vs. Linked Lists: Performance Deep Dive", "topic": "Arrays & Hashing", "url": "#array-vs-list"},
            {"id": 503, "title": "The Power of Heap Data Structure", "topic": "Heaps", "url": "#heap-power"},
            {"id": 504, "title": "Understanding Time and Space Complexity (Big O)", "topic": "Fundamentals", "url": "#big-o"},
            {"id": 505, "title": "String Manipulation Techniques in JavaScript/Python", "topic": "Strings", "url": "#string-tech"},
            {"id": 506, "title": "Backtracking vs Recursion", "topic": "Backtracking", "url": "#backtracking-guide"},
        ];

        /**
         * Implements the logic from SimpleRecommenderAgent in JavaScript, 
         * now using dynamic user input for core recommendation parameters.
         */
        class SimpleRecommenderAgentJS {
            constructor(problemsDb, articlesDb) {
                this.problemsDb = problemsDb;
                this.articlesDb = articlesDb;
                // Map current level to next target level
                this.difficultyMap = {"Easy": "Medium", "Medium": "Hard", "Hard": "Hard"};
            }

            /**
             * Helper function to shuffle an array (used for random selection)
             */
            _shuffleArray(array) {
                const arr = [...array];
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
                return arr;
            }

            /**
             * Generates coding problem and article recommendations based on user-provided data.
             * @param {string} weakTopic - The topic the user wants to improve.
             * @param {string} currentLevel - The highest difficulty level the user consistently solves.
             * @param {string} username - Username for display only.
             * @returns {Object} Recommendations
             */
            getRecommendations(weakTopic, currentLevel, username) {
                console.log(`--- Generating recommendations for user: ${username} (Weak Topic: ${weakTopic}, Current Level: ${currentLevel}) ---`);

                // 1. Determine the target difficulty (push the user to the next level)
                const targetDifficulty = this.difficultyMap[currentLevel] || "Medium";
                console.log(`Targeting problems of difficulty: ${targetDifficulty}`);

                // 2. Generate Problem Recommendations (Topic-based + Difficulty)
                
                // Filter problems by target difficulty and weak topic
                let problemCandidates = this.problemsDb.filter(
                    p => p.difficulty === targetDifficulty && p.topic === weakTopic
                );
                
                if (problemCandidates.length === 0) {
                    // Fallback 1: If no problems match topic AND difficulty, just recommend by target difficulty
                    problemCandidates = this.problemsDb.filter(
                        p => p.difficulty === targetDifficulty
                    );
                }

                // Select up to 2 random problems
                let recommendedProblems = this._shuffleArray(problemCandidates).slice(0, 2);
                
                if (recommendedProblems.length < 2) {
                    // Fallback 2: Fill remaining slots with random Medium problems
                    const mediumProblems = this.problemsDb.filter(p => p.difficulty === "Medium");
                    const remaining = 2 - recommendedProblems.length;
                    const fillerProblems = this._shuffleArray(mediumProblems).slice(0, remaining);
                    // Filter out any duplicates if the target problems were also Medium
                    const uniqueFiller = fillerProblems.filter(f => !recommendedProblems.some(r => r.id === f.id));
                    recommendedProblems.push(...uniqueFiller);
                }


                // 3. Generate Article Recommendation (Topic-based)
                const articleCandidates = this.articlesDb.filter(
                    a => a.topic === weakTopic
                );

                let recommendedArticles = this._shuffleArray(articleCandidates).slice(0, 1);
                
                // Fallback: If no article matches the weak topic, recommend a general fundamentals article
                if (recommendedArticles.length === 0) {
                     const fundamentals = this.articlesDb.filter(a => a.topic === "Fundamentals");
                     recommendedArticles = this._shuffleArray(fundamentals).slice(0, 1);
                }

                return {
                    problems: recommendedProblems,
                    articles: recommendedArticles,
                    analysis: `Hello **${username}**! Based on your input, we identified **${weakTopic}** as your key growth area. We recommend working on **${targetDifficulty}** problems to push your limits in this topic.`,
                };
            }
        }

        // --- UI Logic and Event Handling ---
        const form = document.getElementById('recommendationForm');
        const resultsContainer = document.getElementById('results-container');
        const analysisText = document.getElementById('analysis-text');
        const problemsList = document.getElementById('problems-list');
        const articlesList = document.getElementById('articles-list');
        const loadingSpinner = document.getElementById('loading-spinner');
        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');

        const agent = new SimpleRecommenderAgentJS(DUMMY_CODING_PROBLEMS, DUMMY_ARTICLES);
        
        /**
         * Renders the list of recommendations (problems or articles)
         */
        function renderRecommendations(container, items, type) {
            container.innerHTML = ''; // Clear previous results

            if (items.length === 0) {
                container.innerHTML = `<div class="p-4 text-gray-500">No ${type}s found for this profile at the moment.</div>`;
                return;
            }

            items.forEach(item => {
                let content;
                if (type === 'problem') {
                    content = `
                        <div class="flex items-center justify-between p-4 transition duration-150 hover:bg-blue-50">
                            <div>
                                <p class="text-base font-semibold text-gray-800">${item.title}</p>
                                <p class="text-sm text-gray-500">${item.topic} | Difficulty: <span class="font-medium ${item.difficulty === 'Easy' ? 'text-green-600' : item.difficulty === 'Medium' ? 'text-yellow-600' : 'text-red-600'}">${item.difficulty}</span></p>
                            </div>
                            <span class="text-xs font-semibold px-2 py-1 rounded-full bg-blue-100 text-blue-800">${item.id}</span>
                        </div>
                    `;
                } else if (type === 'article') {
                    content = `
                        <a href="${item.url}" target="_blank" class="block p-4 transition duration-150 hover:bg-green-50">
                            <p class="text-base font-semibold text-gray-800">${item.title}</p>
                            <p class="text-sm text-gray-500">Topic: ${item.topic} <span class="font-bold text-green-600">â†’ Read Now</span></p>
                        </a>
                    `;
                }
                container.innerHTML += content;
            });
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // 1. Get user input from the form
            const username = document.getElementById('username').value.trim() || 'Valued User';
            const weakestTopic = document.getElementById('weakest_topic').value;
            const lastSolvedDifficulty = document.getElementById('last_solved_difficulty').value;

            // Simple validation
            if (!weakestTopic || !lastSolvedDifficulty) {
                 messageText.textContent = `Please select both a Weakest Topic and a Highest Solved Difficulty level to get recommendations.`;
                 messageBox.classList.remove('hidden');
                 resultsContainer.classList.add('hidden');
                 return;
            }
            
            // 2. Show loading, hide results/messages
            resultsContainer.classList.add('hidden');
            messageBox.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');

            // Simulate network delay for a better UX (1.5 seconds)
            await new Promise(resolve => setTimeout(resolve, 1500));

            try {
                // 3. Get recommendations using the user's selected input
                const recommendations = agent.getRecommendations(weakestTopic, lastSolvedDifficulty, username);

                // 4. Render results
                analysisText.innerHTML = recommendations.analysis;
                renderRecommendations(problemsList, recommendations.problems, 'problem');
                renderRecommendations(articlesList, recommendations.articles, 'article');

                // 5. Update UI to show results
                resultsContainer.classList.remove('hidden');

            } catch (error) {
                console.error("Recommendation generation failed:", error);
                messageText.textContent = `An internal error occurred during recommendation generation: ${error.message}.`;
                messageBox.classList.remove('hidden');
            } finally {
                // 6. Hide loading
                loadingSpinner.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
